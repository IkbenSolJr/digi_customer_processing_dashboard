<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- ========== SECURITY CATEGORIES ========== -->
        <record id="module_category_dss_customer" model="ir.module.category">
            <field name="name">DSS Customer Management</field>
            <field name="description">Access rights for DSS Customer Progress Management</field>
            <field name="sequence">20</field>
        </record>

        <!-- ========== SECURITY GROUPS ========== -->
        
        <!-- 1. User Level - Basic Access -->
        <record id="group_dss_user" model="res.groups">
            <field name="name">DSS User</field>
            <field name="category_id" ref="module_category_dss_customer"/>
            <field name="comment">
                Basic user access:
                - View assigned customers only
                - Basic customer information
                - Limited editing rights
            </field>
        </record>

        <!-- 2. Advisor Level - Consultation Access -->
        <record id="group_dss_advisor" model="res.groups">
            <field name="name">DSS Advisor</field>
            <field name="category_id" ref="module_category_dss_customer"/>
            <field name="implied_ids" eval="[(4, ref('group_dss_user'))]"/>
            <field name="comment">
                Advisor access:
                - View customers in department
                - Create and manage training plans
                - Update customer progress
                - View reports for own customers
            </field>
        </record>

        <!-- 3. Officer Level - Processing Access -->
        <record id="group_dss_officer" model="res.groups">
            <field name="name">DSS Officer</field>
            <field name="category_id" ref="module_category_dss_customer"/>
            <field name="implied_ids" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="comment">
                Officer access:
                - Full visa process management
                - Access to sensitive data
                - Manage all process workflows
                - Advanced reporting
            </field>
        </record>

        <!-- 4. Manager Level - Management Access -->
        <record id="group_dss_manager" model="res.groups">
            <field name="name">DSS Manager</field>
            <field name="category_id" ref="module_category_dss_customer"/>
            <field name="implied_ids" eval="[(4, ref('group_dss_officer'))]"/>
            <field name="comment">
                Manager access:
                - Full access to all customers
                - Generate all reports
                - System configuration
                - Team management
            </field>
        </record>

        <!-- 5. Admin Level - System Administration -->
        <record id="group_dss_admin" model="res.groups">
            <field name="name">DSS System Admin</field>
            <field name="category_id" ref="module_category_dss_customer"/>
            <field name="implied_ids" eval="[(4, ref('group_dss_manager'))]"/>
            <field name="comment">
                System Admin access:
                - Full system administration
                - Module configuration
                - Automation setup
                - Data management
            </field>
        </record>

        <!-- ========== RECORD RULES ========== -->

        <!-- Customer Record Rules -->
        <record id="customer_record_rule_user" model="ir.rule">
            <field name="name">Customer Record: User Access</field>
            <field name="model_id" ref="model_digi_customer_record"/>
            <field name="domain_force">[
                '|',
                ('advisor_id.user_id', '=', user.id),
                ('responsible_person_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="customer_record_rule_advisor" model="ir.rule">
            <field name="name">Customer Record: Advisor Access</field>
            <field name="model_id" ref="model_digi_customer_record"/>
            <field name="domain_force">[
                '|', '|', '|',
                ('advisor_id.department_id', '=', user.employee_id.department_id.id),
                ('responsible_person_id.department_id', '=', user.employee_id.department_id.id),
                ('trainer_id.department_id', '=', user.employee_id.department_id.id),
                ('teacher_id.department_id', '=', user.employee_id.department_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="customer_record_rule_officer" model="ir.rule">
            <field name="name">Customer Record: Officer Full Access</field>
            <field name="model_id" ref="model_digi_customer_record"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Training Progress Rules -->
        <record id="training_progress_rule_user" model="ir.rule">
            <field name="name">Training Progress: User Access</field>
            <field name="model_id" ref="model_digi_training_progress"/>
            <field name="domain_force">[
                '|',
                ('customer_id.advisor_id.user_id', '=', user.id),
                ('trainer_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="training_progress_rule_advisor" model="ir.rule">
            <field name="name">Training Progress: Advisor Access</field>
            <field name="model_id" ref="model_digi_training_progress"/>
            <field name="domain_force">[
                '|',
                ('customer_id.advisor_id.department_id', '=', user.employee_id.department_id.id),
                ('trainer_id.department_id', '=', user.employee_id.department_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- English Training Rules -->
        <record id="english_training_rule_user" model="ir.rule">
            <field name="name">English Training: User Access</field>
            <field name="model_id" ref="model_digi_english_training"/>
            <field name="domain_force">[
                '|',
                ('customer_id.teacher_id.user_id', '=', user.id),
                ('teacher_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="english_training_rule_advisor" model="ir.rule">
            <field name="name">English Training: Advisor Access</field>
            <field name="model_id" ref="model_digi_english_training"/>
            <field name="domain_force">[
                '|',
                ('customer_id.teacher_id.department_id', '=', user.employee_id.department_id.id),
                ('teacher_id.department_id', '=', user.employee_id.department_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Visa Process Rules - Restricted to Officers and above -->
        <record id="visa_process_rule_user" model="ir.rule">
            <field name="name">Visa Process: No User Access</field>
            <field name="model_id" ref="model_digi_visa_process"/>
            <field name="domain_force">[(0, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="visa_process_rule_advisor" model="ir.rule">
            <field name="name">Visa Process: Limited Advisor Access</field>
            <field name="model_id" ref="model_digi_visa_process"/>
            <field name="domain_force">[
                ('customer_id.advisor_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="visa_process_rule_officer" model="ir.rule">
            <field name="name">Visa Process: Officer Full Access</field>
            <field name="model_id" ref="model_digi_visa_process"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Test Scores - Sensitive Data -->
        <record id="test_score_rule_user" model="ir.rule">
            <field name="name">Test Score: No User Access</field>
            <field name="model_id" ref="model_digi_english_test_score"/>
            <field name="domain_force">[(0, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="test_score_rule_advisor" model="ir.rule">
            <field name="name">Test Score: Advisor Access</field>
            <field name="model_id" ref="model_digi_english_test_score"/>
            <field name="domain_force">[
                ('customer_id.teacher_id.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Master Data Rules -->
        <record id="visa_type_rule_all" model="ir.rule">
            <field name="name">Visa Type: Read All</field>
            <field name="model_id" ref="model_digi_visa_type"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="visa_type_rule_manager" model="ir.rule">
            <field name="name">Visa Type: Manager Full Access</field>
            <field name="model_id" ref="model_digi_visa_type"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="customer_tag_rule_all" model="ir.rule">
            <field name="name">Customer Tag: All Access</field>
            <field name="model_id" ref="model_digi_customer_tag"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="job_category_rule_all" model="ir.rule">
            <field name="name">Job Category: All Access</field>
            <field name="model_id" ref="model_digi_job_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_dss_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ========== TIME-BASED RESTRICTIONS ========== -->
        
        <!-- Prevent editing after visa granted -->
        <record id="customer_record_rule_granted_readonly" model="ir.rule">
            <field name="name">Customer Record: Granted Visa Read-Only</field>
            <field name="model_id" ref="model_digi_customer_record"/>
            <field name="domain_force">[('visa_result', '=', 'granted')]</field>
            <field name="groups" eval="[(4, ref('group_dss_user')), (4, ref('group_dss_advisor'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ========== MENU ACCESS CONTROL ========== -->
        
        <!-- Assign menu access to appropriate groups via ir.ui.menu records in views -->

    </data>
</odoo>